package service

import (
	"{{.ModulePath}}/internal/application/dto"
	"{{.ModulePath}}/internal/domain/{{.SnakeName}}"
)

// {{.PascalName}}AppService orchestrates {{.ChineseName}} business logic
type {{.PascalName}}AppService struct {
	repo {{.SnakeName}}.Repository
}

// New{{.PascalName}}AppService creates a new application service
func New{{.PascalName}}AppService(repo {{.SnakeName}}.Repository) *{{.PascalName}}AppService {
	return &{{.PascalName}}AppService{repo: repo}
}

// Create creates a new {{.ChineseName}}
func (s *{{.PascalName}}AppService) Create(req *dto.Create{{.PascalName}}Request) (*dto.{{.PascalName}}Response, error) {
	entity := {{.SnakeName}}.New{{.PascalName}}(req.Name)

	if err := s.repo.Save(entity); err != nil {
		return nil, err
	}

	return dto.From{{.PascalName}}(entity), nil
}

// GetByID returns {{.ChineseName}} by ID
func (s *{{.PascalName}}AppService) GetByID(id uint) (*dto.{{.PascalName}}Response, error) {
	entity, err := s.repo.FindByID(id)
	if err != nil {
		return nil, err
	}
	return dto.From{{.PascalName}}(entity), nil
}

// List returns paginated {{.ChineseName}} list
func (s *{{.PascalName}}AppService) List(req *dto.Query{{.PascalName}}Request) ([]*dto.{{.PascalName}}Response, int64, error) {
	if req.Page < 1 {
		req.Page = 1
	}
	if req.PageSize < 1 {
		req.PageSize = 10
	}
	if req.PageSize > 100 {
		req.PageSize = 100
	}

	entities, total, err := s.repo.List(req.Page, req.PageSize, req.Keyword)
	if err != nil {
		return nil, 0, err
	}

	return dto.From{{.PascalName}}List(entities), total, nil
}

// Update updates a {{.ChineseName}}
func (s *{{.PascalName}}AppService) Update(id uint, req *dto.Update{{.PascalName}}Request) (*dto.{{.PascalName}}Response, error) {
	entity, err := s.repo.FindByID(id)
	if err != nil {
		return nil, err
	}

	if req.Name != nil {
		entity.UpdateInfo(*req.Name)
	}
	// TODO: Add other field updates

	if err := s.repo.Save(entity); err != nil {
		return nil, err
	}

	return dto.From{{.PascalName}}(entity), nil
}

// Delete deletes a {{.ChineseName}}
func (s *{{.PascalName}}AppService) Delete(id uint) error {
	return s.repo.Delete(id)
}
